meta:
  procedure_group: ercp
  procedure_type: ercp_base
  title: Endoscopic Retrograde Cholangiopancreatography
prompts:
  definition_file: prompts/ercp/generated_ercp_base_prompt.txt
templates:
  indications: '{{ age }}-year-old {{ sex }} patient is here for an ERCP procedure
    {% if chief_complaints | skip_unknown %}for {{ chief_complaints | skip_unknown
    | lower }}{% endif %}.'
  history: 'The patient reports {{ symptoms_duration | skip_unknown }} history of
    {{ chief_complaints | lower | skip_unknown }}.

    {{ symptoms_description | skip_unknown | sentence | capfirst }}

    {% if negative_history | skip_unknown %} No history of {{ negative_history | skip_unknown
    }} is reported unless otherwise specified.{% endif %}

    {% if past_medical_history | skip_unknown %}{{ past_medical_history | skip_unknown
    | capfirst | sentence }}{% endif %} {% if current_medications | skip_unknown %}Current
    medications include {{ current_medications | skip_unknown }}.{% endif %}

    {% if family_history | skip_unknown %}{{ family_history | skip_unknown | sentence
    }}{% endif %} {% if social_history | skip_unknown %}{{ social_history | skip_unknown
    | sentence }}{% endif %}'
  medications: Refer to record of source.
  monitoring: Johns Hopkins Standard.
  pre-procedure exam: Please see pre-procedure history and physical exam in Medical
    Records.
  description_of_procedure: '{% set scope_type = duodenoscope_type | default('''')
    | skip_unknown %}

    After the risks, benefits and alternatives of the procedure were thoroughly explained,
    informed consent was verified, confirmed and timeout was successfully executed
    by the treatment team. With the patient in the left semi-prone position, medications
    were administered intravenously. The duodenoscope {% if scope_type %}{{ scope_type
    }} {% endif %}was passed from the mouth into the esophagus and further advanced
    from the esophagus into the stomach. From the stomach, the scope was directed
    to the second portion of the duodenum.'
  ercp_quality_metrics: 'Difficulty of ERCP: {% if grade_of_ercp | skip_unknown %}Grade
    {{ grade_of_ercp }}.{% endif %}{% if pd_cannulation | skip_unknown %} pancreatic
    duct cannulation {{ pd_cannulation | sentence }}

    {% endif %}

    {% if cannulation_success is defined %}

    Cannulation success: {% if cannulation_success %}Yes{% else %}No{% endif %}.

    {% endif %}

    {% if lactated_ringers is defined %}

    Post-ERCP pancreatitis prophylaxis:{% if lactated_ringers %}Lactated ringers:
    Yes, refer to record of source{% else %}No{% endif %}.

    {% endif %}

    {% if rectal_indomethacin is defined %}Rectal indomethacin: {% if rectal_indomethacin
    %} Yes

    {% else %}No{% endif %}.

    {% endif %}

    {% if successful_completion is defined %}Successful completion of intended procedure:
    {% if successful_completion %}Yes{% else %}No{% endif %}.

    {% endif %}

    {% if failed_ercp is defined %}

    Failed ERCP from another facility or provider: {% if failed_ercp %}Yes{% else
    %}No{% endif %}.{% endif %}'
  findings: "{% set status = scout_film_status | default('') | skip_unknown %}\n{%\
    \ if status == 'not_obtained' %}\nA scout film was not obtained.\n{% else %}\n\
    A scout film of the abdomen was performed. {% if status == 'normal' %}It appeared\
    \ normal.{% endif %}\n{% if scout_film_optional_findings | skip_unknown and scout_film_optional_findings\
    \ != 'none' %} {{ scout_film_optional_findings }}.{% endif %}\n{% if scout_film_free_text\
    \ | skip_unknown and scout_film_free_text != 'none' %} {{ scout_film_free_text\
    \ | capfirst }}.{% endif %}\n{% endif %}\n\n{% set difficulty = scope_advancement_difficulty\
    \ | default('') | skip_unknown %}\n{% set gi_findings = upper_gi_findings | default('')\
    \ | skip_unknown %}\n{% set exam_type = upper_gi_examination | default('limited')\
    \ %}\n\nThe duodenoscope {% if duodenoscope_type | skip_unknown %}{{ duodenoscope_type\
    \ }} {% endif %}was advanced to the second portion of the duodenum {% if difficulty\
    \ == 'difficult' %}with difficulty{% else %}without difficulty{% endif %} and\
    \ {% if exam_type == 'detailed' %}with detailed{% else %}without detailed{% endif\
    \ %} examination of the upper GI tract.\n{% if gi_findings == 'normal' or not\
    \ gi_findings %} The esophagus, stomach, and duodenum appeared unremarkable on\
    \ limited inspection.{% else %} {{ gi_findings | capfirst }} were seen.{% endif\
    \ %}\n{% if difficulty == 'difficult' %} Scope advancement was challenging due\
    \ to {{ scope_advancement_difficulty_reason  | skip_unknown }} {% endif %}\n\n\
    {% set status = major_papilla_status | default('') | skip_unknown %}\n{% if status\
    \ == 'not visualized' %}\nThe major papilla could not be located, and the procedure\
    \ was aborted.\n{% else %}\nThe major papilla was identified. {% if status ==\
    \ 'normal' %}It appeared normal in position and morphology, with an intact orifice\
    \ and no surrounding erythema or edema.{% elif status == 'abnormal' and major_papilla_abnormal_morphology\
    \ | skip_unknown and major_papilla_abnormal_morphology != 'none' %}The papilla\
    \ appeared {{ major_papilla_abnormal_morphology }}.{% endif %}\n{% if prior_biliary_sphincterotomy_evidence\
    \ %}After removal of the previously placed stent, evidence of prior sphincterotomy\
    \ was present. {% if prior_biliary_sphincterotomy_orifice_patency | skip_unknown\
    \ %}Orifice was {{ prior_biliary_sphincterotomy_orifice_patency }}.{% endif %}{%\
    \ endif %}\n{% if papilla_stent_present %}A previously placed plastic or metal\
    \ stent was seen emerging from the major papilla.{% endif %}\n{% if periampullary_diverticulum_present\
    \ %} Periampullary diverticulum present.{% if papilla_diverticulum_relationship\
    \ | skip_unknown and papilla_diverticulum_relationship not in ['not_applicable',\
    \ 'not_described'] %} Papilla located {% if papilla_diverticulum_relationship\
    \ == 'inside_diverticulum' %}inside the diverticulum{% elif papilla_diverticulum_relationship\
    \ == 'on_rim' %}on the rim of the diverticulum{% elif papilla_diverticulum_relationship\
    \ == 'adjacent' %}directly adjacent to the diverticulum{% elif papilla_diverticulum_relationship\
    \ == 'away' %}away from the diverticulum{% endif %}.{% endif %}{% endif %}\n{%\
    \ if major_papilla_free_text | skip_unknown and major_papilla_free_text != 'none'\
    \ %} {{ major_papilla_free_text | capfirst }}.{% endif %}\n{% endif %}\n\n{% set\
    \ status = minor_papilla_status | default('') | skip_unknown %}\n{% if status\
    \ == 'not_inspected' %}\nThe minor papilla was not inspected.\n{% elif status\
    \ == 'not_visualized' %}\nThe minor papilla could not be located.\n{% elif status\
    \ in ['normal', 'abnormal'] %}\nThe minor papilla was identified and inspected.\
    \ {% if status == 'normal' %}It appeared normal in position and morphology, with\
    \ an intact orifice and no surrounding erythema or edema.{% elif minor_papilla_morphology\
    \ | skip_unknown %}The papilla appeared {{ minor_papilla_morphology }}.{% endif\
    \ %}\n{% if minor_papilla_prior_sphincterotomy_evidence %}After removal of the\
    \ previously placed stent, evidence of prior sphincterotomy was present. {% if\
    \ minor_papilla_orifice_patency | skip_unknown and minor_papilla_orifice_patency\
    \ not in ['none', 'unknown'] %}Orifice was {{ minor_papilla_orifice_patency |\
    \ replace('_', ' ') }}.{% endif %}{% endif %}\n{% if minor_papilla_free_text |\
    \ skip_unknown and minor_papilla_free_text != 'none' %} {{ minor_papilla_free_text\
    \ | sentence }}.{% endif %}\n{% endif %}\n\n{% if ampulla_overall_appearance |\
    \ skip_unknown %}\nThe ampulla was identified and found to be {{ ampulla_overall_appearance\
    \ }}.{% if ampulla_pus_present %} Pus was seen draining.{% endif %}\n{% if ampulla_active_bleeding\
    \ %} Active bleeding was observed.{% endif %}\n{% if ampulla_free_text | skip_unknown\
    \ and ampulla_free_text != 'none' %} {{ ampulla_free_text | capfirst }}.{% endif\
    \ %}{% endif %}\n\n{% if ampullectomy_performed %}\nAfter a submucosal lift{%\
    \ if snare_size_mm > 0 %}, a {{ snare_size_mm }} mm snare{% else %}, a snare{%\
    \ endif %} was used to perform ampullectomy. Resection was performed {% if resection_style\
    \ | skip_unknown and resection_style not in ['none', 'unknown'] %}{{ resection_style\
    \ | replace('_', ' ') }}{% endif %}{% if energy_settings | skip_unknown and energy_settings\
    \ != 'not specified' %} using electrocautery {{ energy_settings }}{% endif %}.\
    \ The specimen was retrieved {% if specimen_retrieval_method | skip_unknown and\
    \ specimen_retrieval_method != 'not specified' %}{{ specimen_retrieval_method\
    \ }}{% endif %} and sent for histopathology. The resection base and margins were\
    \ carefully inspected; {% if resection_base_assessment | skip_unknown %}{{ resection_base_assessment\
    \ }}{% endif %}.{% if ampullectomy_hemostasis_method | skip_unknown and ampullectomy_hemostasis_method\
    \ != 'none' %} Hemostasis was achieved with {{ ampullectomy_hemostasis_method\
    \ }}.{% endif %}\n{% endif %}\n\n{% if sphincterotome_type | skip_unknown or guidewire_type\
    \ | skip_unknown %}\nBile duct cannulation was attempted using a sphincterotome{%\
    \ if sphincterotome_type | skip_unknown %} ({{ sphincterotome_type }}){% endif\
    \ %} preloaded with a guidewire{% if guidewire_type | skip_unknown %} ({{ guidewire_type\
    \ }}){% endif %}.\n{% endif %}\n{% if bile_duct_cannulation_successful is defined\
    \ %}\n{% if bile_duct_cannulation_successful %}\nBile duct cannulation was successful.\
    \ Biliary cannulation was achieved{% if bile_duct_cannulation_difficulty | skip_unknown\
    \ %}. {{ bile_duct_cannulation_difficulty | capfirst }}{% else %} without pancreatic\
    \ duct entry{% endif %}.{% if advanced_cannulation_techniques | skip_unknown and\
    \ advanced_cannulation_techniques != 'none' %} Cannulation achieved via {{ advanced_cannulation_techniques\
    \ }}.{% endif %}\n{% else %}\nBile duct cannulation was unsuccessful.{% if bile_duct_cannulation_difficulty\
    \ | skip_unknown %} {{ bile_duct_cannulation_difficulty | capfirst }}.{% endif\
    \ %}{% if advanced_cannulation_techniques | skip_unknown and advanced_cannulation_techniques\
    \ != 'none' %} {{ advanced_cannulation_techniques | capfirst }} was performed.{%\
    \ endif %}{% if rendezvous_attempted %}{% if rendezvous_result | skip_unknown\
    \ %} EUS-guided rendezvous was performed and was {{ rendezvous_result }}.{% else\
    \ %} Rendezvous was planned.{% endif %}{% else %} The procedure was terminated.{%\
    \ endif %}\n{% endif %}\n{% endif %}\n\n{% set attempt = pancreatic_duct_cannulation_attempted\
    \ | default('') | skip_unknown %}\n{% if attempt == 'intentional' %}\nPancreatic\
    \ duct cannulation was attempted.{% if pancreatic_duct_cannulation_success %}\
    \ Pancreatic duct was selectively cannulated{% if pancreatic_duct_cannulation_technique\
    \ | skip_unknown %} with {{ pancreatic_duct_cannulation_technique }}{% endif %}.{%\
    \ else %} Cannulation was unsuccessful.{% endif %}\n{% elif attempt == 'not_attempted_inadvertent'\
    \ %}\nPancreatic duct cannulation was not attempted but was inadvertently cannulated.\n\
    {% endif %}\n{% if biliary_rendezvous_route | skip_unknown and biliary_rendezvous_route\
    \ != 'not applicable' %} {{ biliary_rendezvous_route | capfirst }} puncture was\
    \ performed.{% endif %}\n\n{% if contrast_injection_performed %}\nContrast was\
    \ injected under fluoroscopic guidance and cholangiogram was performed.\n{% if\
    \ cbd_diameter_mm > 0 %}The common bile duct (CBD) measured {{ cbd_diameter_mm\
    \ }} mm{% if cbd_diameter_mm >= 6 and cbd_diameter_mm <= 10 %} and was normal{%\
    \ endif %}.{% endif %}\n{% if ihd_status | skip_unknown and ihd_status not in\
    \ ['unknown', 'none'] %} Intrahepatic ducts were {{ ihd_status | replace('_',\
    \ ' ') }}{% if ihd_status == 'normal' %} in caliber, and contrast drained freely\
    \ into the duodenum{% endif %}.{% endif %}\n{% if stone_description | skip_unknown\
    \ and stone_description != 'none' %} {{ stone_description | capfirst }}.{% endif\
    \ %}\n{% if stricture_description | skip_unknown and stricture_description !=\
    \ 'none' %} {{ stricture_description | capfirst }}.{% endif %}\n{% if non_stone_filling_defects\
    \ | skip_unknown and non_stone_filling_defects != 'none' %} {{ non_stone_filling_defects\
    \ | capfirst }}.{% endif %}\n{% if bile_leak_location | skip_unknown and bile_leak_location\
    \ != 'none' %} Contrast extravasation from the {{ bile_leak_location }} consistent\
    \ with a bile leak.{% endif %}\n{% if prior_stent_status | skip_unknown and prior_stent_status\
    \ != 'none' %} {{ prior_stent_status | capfirst }}.{% endif %}\n{% if cholangiogram_free_text\
    \ | skip_unknown and cholangiogram_free_text != 'none' %} {{ cholangiogram_free_text\
    \ | capfirst }}.{% endif %}\n{% else %}\nContrast injection was not performed.\n\
    {% endif %}\n\n{% if pancreatogram_obtained %}\nPancreatogram was obtained{% if\
    \ pancreatogram_overall | skip_unknown %} and {{ pancreatogram_overall }} identified{%\
    \ endif %}.\n{% if main_pd_diameter_head_mm > 0 or main_pd_diameter_body_mm >\
    \ 0 or main_pd_diameter_tail_mm > 0 %} Main PD diameter was{% if main_pd_diameter_head_mm\
    \ > 0 %} {{ main_pd_diameter_head_mm }} mm at head{% endif %}{% if main_pd_diameter_body_mm\
    \ > 0 %}{% if main_pd_diameter_head_mm > 0 %},{% endif %} {{ main_pd_diameter_body_mm\
    \ }} mm at body{% endif %}{% if main_pd_diameter_tail_mm > 0 %}{% if main_pd_diameter_head_mm\
    \ > 0 or main_pd_diameter_body_mm > 0 %},{% endif %} {{ main_pd_diameter_tail_mm\
    \ }} mm at tail{% endif %}.{% endif %}\n{% if side_branch_status | skip_unknown\
    \ and side_branch_status not in ['unknown', 'none'] %} Side branches were {{ side_branch_status\
    \ }}.{% endif %}\n{% if pd_stricture_location | skip_unknown and pd_stricture_location\
    \ != 'none' %} Stricture was located at {{ pd_stricture_location }}.{% endif %}\n\
    {% if pd_pseudocyst_communication is defined %} There was {% if not pd_pseudocyst_communication\
    \ %}no {% endif %}communication with pseudocyst.{% endif %}\n{% else %}\nPancreatogram\
    \ was not performed.\n{% endif %}\n\n{% if sphincterotomy_type | skip_unknown\
    \ and sphincterotomy_type != 'none' %}\n{% set ns = namespace(parts=[]) %}\n{#\
    \ base sentence: mention sphincterotomy and optional instrument #}\n{% set base\
    \ = 'Sphincterotomy was performed' %}\n{% if sphincterotome_used | skip_unknown\
    \ %}\n  {% set base = base ~ ' using a ' ~ (sphincterotome_used) %}\n{% endif\
    \ %}\n{% set base = base ~ '.' %}\n{% set ns.parts = ns.parts + [base] %}\n\n\
    {# optional incision details: direction, extent, and goal #}\n{% if incision_direction\
    \ | skip_unknown %}\n  {% set clause = 'The incision was directed toward the '\
    \ ~ incision_direction ~ ' position' %}\n  {% if sphincterotomy_extent | skip_unknown\
    \ and sphincterotomy_extent != 'none' %}\n    {% set clause = clause ~ ' and extended\
    \ to a ' ~ sphincterotomy_extent ~ ' papillotomy' %}\n    {% if sphincterotomy_goal_achieved\
    \ | skip_unknown %}\n      {% set clause = clause ~ ' until ' ~ sphincterotomy_goal_achieved\
    \ ~ ' was achieved' %}\n    {% endif %}\n  {% endif %}\n  {% set clause = clause\
    \ ~ '.' %}\n  {% set ns.parts = ns.parts + [clause] %}\n{% endif %}\n\n{{ ns.parts\
    \ | join(' ') }}\n{% endif %}\n\n{% if biliary_stent_placed %}\n{% if plastic_stent_details\
    \ | skip_unknown %}A {{ plastic_stent_details}} was placed. {% elif metal_stent_details\
    \ | skip_unknown %}A {{ metal_stent_details }} was placed. {% endif %}\nThe scope\
    \ was then completely withdrawn from the patient and the procedure completed.\n\
    {% endif %}\n\n{% if pancreatic_stent_placed %}\n{% if pancreatic_stent_purpose\
    \ == 'pep_prophylaxis' %}\nA pancreatic stent for PEP prophylaxis was placed.{%\
    \ if pancreatic_stent_details | skip_unknown %} {{ pancreatic_stent_details |\
    \ capfirst }}.{% endif %}\n{% elif pancreatic_stent_purpose == 'therapeutic' %}\n\
    A therapeutic pancreatic stent was placed.{% if pancreatic_stent_details | skip_unknown\
    \ %} {{ pancreatic_stent_details | capfirst }}.{% endif %}\n{% endif %}\n{% if\
    \ stent_optimal_description | skip_unknown %} {{ stent_optimal_description | capfirst\
    \ }}.{% endif %}\n{% if bile_and_contrast_drainage | skip_unknown %} {{ bile_and_contrast_drainage\
    \ | capfirst }}.{% endif %}\n{% if final_fluoroscopic_image_obtained %} Final\
    \ fluoroscopic picture was done for confirmation.{% endif %}\n{% endif %}\n\n\
    {% if estimated_blood_loss > 0 %}\nEstimated blood loss: {{ estimated_blood_loss\
    \ }} ml.\n{% elif estimated_blood_loss == 0 %}\nEstimated blood loss: None.\n\
    {% endif %}\n\n{% if specimens_removed | skip_unknown and specimens_removed !=\
    \ 'none' %}\nSpecimens removed: Specimens were optained. {{ specimens_removed\
    \ | capfirst | sentence }}.\n{% elif specimens_removed == 'none' %}\nSpecimens\
    \ removed: None.\n{% endif %}\n\n{% if complications | skip_unknown and complications\
    \ != 'none' %}\nComplications: {{ complications | capfirst }}.\n{% elif complications\
    \ == 'none' %}\nComplications: There were no immediate complications.\n{% endif\
    \ %}"
  impressions: ''
